<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paul Julian">
<meta name="dcterms.date" content="2024-11-17">

<title>Paul Julian II, PhD - Time series Analysis (Part III), Welcome to the Kendall Family?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/SWE_logo_small.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-131175448-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<link href="../site_libs/tabwid-1.1.2/tabwid.css" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/SWE_logo_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Paul Julian II, PhD</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../_files/Julian_CV.pdf" rel="" target="">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/SwampThingPaul" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/paul-julian/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:pauljulianphd@gmail.com" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#trend-tests" id="toc-trend-tests" class="nav-link active" data-scroll-target="#trend-tests">Trend Tests</a>
  <ul class="collapse">
  <li><a href="#kendall-trend-test" id="toc-kendall-trend-test" class="nav-link" data-scroll-target="#kendall-trend-test">Kendall Trend Test</a></li>
  <li><a href="#seasonal-mann-kendall-trend-test" id="toc-seasonal-mann-kendall-trend-test" class="nav-link" data-scroll-target="#seasonal-mann-kendall-trend-test">Seasonal Mann-Kendall Trend Test</a></li>
  <li><a href="#other-kendall-tests" id="toc-other-kendall-tests" class="nav-link" data-scroll-target="#other-kendall-tests">Other Kendall Tests</a></li>
  <li><a href="#usgs-software-vs-r-package" id="toc-usgs-software-vs-r-package" class="nav-link" data-scroll-target="#usgs-software-vs-r-package">USGS software vs R-package</a></li>
  </ul></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">Whats next?</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Time series Analysis (Part III), Welcome to the Kendall Family?</h1>
  <div class="quarto-categories">
    <div class="quarto-category">blog</div>
    <div class="quarto-category">time series</div>
    <div class="quarto-category">trend</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Paul Julian </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 17, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>So far we’ve gone over the basics of time series (<a href="https://swampthingecology.org/news/20241026_Timeseries1.html" target="_blank">Part I</a>), minimum number of samples, power analyses and some basic trend analyses (<a href="https://swampthingecology.org/news/20241103_Timeseries2.html" target="_blank">Part II</a>). In this post we will talk more explicitly about the Kendall family of trend test, more specifically seasonal trends.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assests/20241117_Timeseries3/the-god-father-marlon-brando.gif" class="img-fluid figure-img" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
<section id="trend-tests" class="level1">
<h1>Trend Tests</h1>
<p>In the last two posts I introduce the Kendall trend test. In those posts, I used the <code>cor.test(..., method="kendall")</code> function in <code>stat</code> (i.e.&nbsp;base) R. There are several different R-packages dedicated to trend analyses such as <code>Kendall</code>, <code>trend</code>, <code>wq</code> and <code>EnvStats</code>. This is by no means an exhaustive list and I’m sure there are other package on CRAN, GitHub or other platforms that do trend analyses. In my years of being a data analyst, specific to trend analyses these packages (and other platforms) were compared to the USGS Computer program for the Kendall family of trend test but more on that later.</p>
<section id="kendall-trend-test" class="level2">
<h2 class="anchored" data-anchor-id="kendall-trend-test">Kendall Trend Test</h2>
<p>While this might come down to semantics but across the literature you’ll seen <strong>Mann-Kendall</strong> (trend) test and <strong>Kendall</strong> trend test, test or rank correlation test. Overall these tests are one in the same, its partly in how they are applied (to some degree). For instance the Mann-Kendall test specifically used to detect monotonic trend in a time series while Kendall tests whether two variables are related in a monotonic way, irrespective of temporal structure. Moreover, the Mann-Kendall test incorporates the temporal order of observation to assess whether values are consistently increasing or decreasing over time. Therefore, one could say (and the <code>EnvStats</code> help page for <code>kendallTrendTest</code> provides a detailed discussion) that the Mann-Kendall is a special case of the test for independence based on the Kendall’s tau statistic. Which both the &amp;#120591 (Kendall) and S-statistic (Mann-Kendall) both measure the ratio of concordant and discordant pairs, its just the Mann-Kendall interpretation includes a time order. If you dig into the source code for <code>stats::cor.test()</code> and <code>EnvStats::kendallTrendTest</code> you’ll see things are calculated nearly identically.</p>
<p>While the Kendall (or Mann-Kendall in our case) is a non-parametric statistic, as in there are no assumptions made about the distribution of the X (time) and Y variables there are some assumptions of the test.</p>
<ul>
<li><strong>Monotonic Trend:</strong> the test assumes (hence its use to test the hypothesis) the presence of a monotonic trend in the data (irrespective of direction) but does not assume linearity.
<ul>
<li>If the data set has periodic components it could mislead results. Below is an example where one dataset is monotonically increasing (left) while the other is increasing there is a strong seasonal component (right), both are significantly increasing. If you do the trend analysis, this variability in the second (right) dataset is reflected in the lower (tau or S-statistic … depending on the test).</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20241117_Timeseries3_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Contrasting simulated time series realtive to trend.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Data Independence:</strong> the observations in the time series are assumed to be independent. If there is serial autocorrelation then the test statistic could be biased. However, given the nature of the data, serial correlations are sometimes unavoidable and generally pose a challenge. However, there are ways to check and methods, such as “<em>pre-whitening</em>” to account for it.</li>
</ul>
<p>To check for serial correlation a simple autocorrelation function can be used. There are other tests like the Durbin-Watson test <code>lmtest::dwtest</code> or the Breusch-Godfrey test <code>lmtest::bgtest</code> but these test evaluate the residuals of the model to evaluate autocorrelation not autocorrelation of the data itself like <code>acf</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20241117_Timeseries3_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">ACF plot of the simulated time series datasets.</figcaption>
</figure>
</div>
</div>
</div>
<p>Here is a pre-whitening method that can be implemented without any additional packages. The pre-whitening procedure accounts for autocorrelation and removes its “effect” by performing the trend analysis on the residuals of the ar model. For more reading on pre-whitening here is a great paper I’ve come across and frequently come back to.</p>
<p>Yue S, Pilon P. 2004. A comparison of the power of the t test, Mann-Kendall and bootstrap tests for trend detection. Hydrological Sciences Journal. 49:1–37. https://doi.org/10.1623/hysj.49.1.21.53996</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulated data (used simulate_timeseries function from prior posts)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span>  <span class="fu">simulate_timeseries</span>(<span class="at">n=</span>n.vals,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seasonal_period =</span> <span class="dv">1</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seasonal_amp=</span><span class="dv">1</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trend_slope=</span><span class="fl">0.1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>timeseries  <span class="ot">&lt;-</span>  <span class="fu">cbind</span>(test<span class="sc">$</span>timeseries,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">expand.grid</span>(<span class="at">Mon =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Yr =</span> <span class="dv">1990</span><span class="sc">:</span>(<span class="dv">1990</span><span class="sc">+</span>(n.yrs<span class="dv">-1</span>)))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>timeseries<span class="sc">$</span>date <span class="ot">&lt;-</span>  <span class="fu">with</span>(test<span class="sc">$</span>timeseries,<span class="fu">as.Date</span>(<span class="fu">paste</span>(Yr,Mon,<span class="st">"01"</span>,<span class="at">sep=</span><span class="st">"-"</span>)))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>timeseries<span class="sc">$</span>dec.date <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">decimal_date</span>(test<span class="sc">$</span>timeseries<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit AR(1) Model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ar_model <span class="ot">&lt;-</span> <span class="fu">ar</span>(test<span class="sc">$</span>timeseries<span class="sc">$</span>value, <span class="at">order.max =</span> <span class="dv">1</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"yule-walker"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ar_model$order  # Optimal order selected</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ar_model$ar     # Estimated AR(1) coefficient</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>timeseries<span class="sc">$</span>ar.residuals <span class="ot">&lt;-</span> ar_model<span class="sc">$</span>resid</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(ar_model$resid, type = "l", main = "Residuals")</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Kendall Test on Residuals</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(test<span class="sc">$</span>timeseries,<span class="fu">cor.test</span>(ar.residuals,dec.date,<span class="at">method=</span><span class="st">"kendall"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kendall's rank correlation tau

data:  ar.residuals and dec.date
z = 2.6877, p-value = 0.007194
alternative hypothesis: true tau is not equal to 0
sample estimates:
      tau 
0.2402104 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(test<span class="sc">$</span>timeseries<span class="sc">$</span>ar.residuals,<span class="at">na.action=</span>na.pass,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="st">"dodgerblue1"</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">main=</span><span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20241117_Timeseries3_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># another way to do it (like zyp R-package)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> test<span class="sc">$</span>timeseries<span class="sc">$</span>value</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">acf</span>(data,<span class="at">lag.max=</span><span class="dv">1</span>,<span class="at">plot=</span><span class="cn">FALSE</span>,<span class="at">na.action=</span>na.pass)<span class="sc">$</span>acf[<span class="dv">2</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(test<span class="sc">$</span>timeseries<span class="sc">$</span>value)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>residuals2 <span class="ot">&lt;-</span> (data[<span class="dv">2</span><span class="sc">:</span>n] <span class="sc">-</span> c <span class="sc">*</span> data[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> c)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>pw.time <span class="ot">&lt;-</span> test<span class="sc">$</span>timeseries<span class="sc">$</span>dec.date[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(residuals2,pw.time,<span class="at">method=</span><span class="st">"kendall"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kendall's rank correlation tau

data:  residuals2 and pw.time
z = 2.6877, p-value = 0.007194
alternative hypothesis: true tau is not equal to 0
sample estimates:
      tau 
0.2402104 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(residuals2,<span class="at">na.action=</span>na.pass,<span class="at">col=</span><span class="st">"dodgerblue1"</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">main=</span><span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20241117_Timeseries3_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You get the same results!!</p>
<ul>
<li><p><strong>Homogeneity:</strong> The data must come from a homogeneous population, meaning that the process generating the data does not change systematically over time.</p></li>
<li><p><strong>Handling Ties:</strong> The test assumes that ties (equal values in the data) are either minimal or appropriately accounted for.</p></li>
<li><p><strong>Sufficient Sample Size:</strong> A sufficiently large sample size is required to achieve reliable results, particularly for datasets with variability. See last post about sample size and statistical power.</p></li>
</ul>
<p>While data can be aggregated to be tested using the Mann-Kendall test, if the data has a strong seasonal component or serial dependence then its usually recommended (depending on the question being asked) to use the seasonal Mann-Kendall Test to adjust for autocorrelation.</p>
</section>
<section id="seasonal-mann-kendall-trend-test" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-mann-kendall-trend-test">Seasonal Mann-Kendall Trend Test</h2>
<p>Most of the assumptions of the Seasonal Mann-Kendall trend test are similar to those of the Mann-Kendall test, just most are applied to the seasonal data. The key assumptions are:</p>
<ul>
<li><p><strong>Seasonal Independence:</strong> Each group or season is treated as an independent data set and therefore the seasonal trends are independent of one another.</p></li>
<li><p><strong>Consistency in Seasonal Grouping:</strong> The data must be grouped into consistent and comparable seasons or time periods (e.g., months, quarters). The length of seasons should be uniform across the data set. Other methods could be applied if the start of a particular season is not consistent (stay tuned).</p></li>
<li><p><strong>Homogeneity of Data within Seasons:</strong> The data must come from a homogeneous population during a particular season. Some text regarding the method also references data coming from the same distribution within each season, however I have not been able to find a consistent method. The <code>EnvStats</code> package does have a heterogeneity test built into the <code>kendallSeasonalTrendTest()</code> but this test focus on evaluating if there is heterogeneity of trend direction across seasons.</p></li>
<li><p><strong>Trend within Seasons is Monotonic:</strong> similar to Mann-Kendall assumptions above but specific for each season.</p></li>
</ul>
<p>When doing the seasonal Mann-Kendall test, the one thing I check first is the Heterogeneity Test for Trend. As mentioned above, the <code>EnvStats::kendallSeasonalTrendTest()</code> performed this test along with all the other trend analyses. Here is an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span>  <span class="fu">simulate_timeseries</span>(<span class="at">n=</span>n.vals,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seasonal_period =</span> <span class="dv">4</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seasonal_amp=</span><span class="dv">2</span>,<span class="at">trend_slope=</span><span class="fl">0.1</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>timeseries  <span class="ot">&lt;-</span>  <span class="fu">cbind</span>(test2<span class="sc">$</span>timeseries,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">expand.grid</span>(<span class="at">Mon =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">Yr =</span> <span class="dv">1990</span><span class="sc">:</span>(<span class="dv">1990</span><span class="sc">+</span>(n.yrs<span class="dv">-1</span>)))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>timeseries<span class="sc">$</span>date <span class="ot">&lt;-</span>  <span class="fu">with</span>(test2<span class="sc">$</span>timeseries,<span class="fu">as.Date</span>(<span class="fu">paste</span>(Yr,Mon,<span class="st">"01"</span>,<span class="at">sep=</span><span class="st">"-"</span>)))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>timeseries<span class="sc">$</span>dec.date <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">decimal_date</span>(test2<span class="sc">$</span>timeseries<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will assume that month is the season of interest. This could also be broken into meterological, or hydrological seasons as well, but they have to be numeric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnvStats)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kendallSeasonalTrendTest</span>(value<span class="sc">~</span>Mon<span class="sc">+</span>Yr,test2<span class="sc">$</span>timeseries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results of Hypothesis Test
--------------------------

Null Hypothesis:                 All 12 values of tau = 0

Alternative Hypothesis:          The seasonal taus are not all equal
                                 (Chi-Square Heterogeneity Test)
                                 At least one seasonal tau != 0
                                 and all non-zero tau's have the
                                 same sign (z Trend Test)

Test Name:                       Seasonal Kendall Test for Trend
                                 (with continuity correction)

Estimated Parameter(s):          tau       =     0.9666667
                                 slope     =     1.2048690
                                 intercept = -2383.2278857

Estimation Method:               tau:        Weighted Average of
                                             Seasonal Estimates
                                 slope:      Hirsch et al.'s
                                             Modification of
                                             Thiel/Sen Estimator
                                 intercept:  Median of
                                             Seasonal Estimates

Data:                            y      = value
                                 season = Mon  
                                 year   = Yr   

Data Source:                     test2$timeseries

Sample Sizes:                    1     =  5
                                 2     =  5
                                 3     =  5
                                 4     =  5
                                 5     =  5
                                 6     =  5
                                 7     =  5
                                 8     =  5
                                 9     =  5
                                 10    =  5
                                 11    =  5
                                 12    =  5
                                 Total = 60

Test Statistics:                 Chi-Square (Het) = 0.400000
                                 z (Trend)        = 8.131728

Test Statistic Parameter:        df = 11

P-values:                        Chi-Square (Het) = 9.999996e-01
                                 z (Trend)        = 4.232137e-16

Confidence Interval for:         slope

Confidence Interval Method:      Gilbert's Modification of
                                 Theil/Sen Method

Confidence Interval Type:        two-sided

Confidence Level:                95%

Confidence Interval:             LCL = 1.110484
                                 UCL = 1.333063</code></pre>
</div>
</div>
<p>In the results you see <em>Test Statistics: Chi-Square (Het)</em> and <em>P-values: Chi-Square (Het)</em> these are the results of the Van Belle-Hughes Heterogeneity Test for Trend. If you wanted to do this outside of the <code>EnvStats</code> package you can with the following example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Format the data</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>test2.df <span class="ot">&lt;-</span> <span class="fu">dcast</span>(test2<span class="sc">$</span>timeseries,Yr<span class="sc">~</span>Mon,<span class="at">value.var=</span><span class="st">"value"</span>,mean)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#yr.vals &lt;- as.numeric(names(test2.df[, -1]))</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>mk_results <span class="ot">&lt;-</span> <span class="fu">apply</span>(test2.df[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">1</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                       tmp <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="at">x=</span>x,<span class="at">y=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x),<span class="at">method=</span><span class="st">"kendall"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                       tmp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tau=</span><span class="fu">as.numeric</span>(tmp<span class="sc">$</span>estimate),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">pval=</span><span class="fu">as.numeric</span>(tmp<span class="sc">$</span>p.value)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">return</span>(tmp2)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                      }</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract p-values and tau values</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(mk_results, <span class="cf">function</span>(x) x<span class="sc">$</span>pval)  <span class="co"># p-values</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>tau_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(mk_results, <span class="cf">function</span>(x) x<span class="sc">$</span>tau)  <span class="co"># Tau values</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a chi-square test for heterogeneity</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>chi_square_result <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(p_values)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>chi_square_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared test for given probabilities

data:  p_values
X-squared = 0.23069, df = 4, p-value = 0.9938</code></pre>
</div>
</div>
<p>While the chi-squared statistic differs slightly, the p-value remains the same and does a good job approximating the method in <code>EnvStats</code>.</p>
<p>This can also be done using the <code>Kendall</code> R-package like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Kendall)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Format the data</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>test2.df <span class="ot">&lt;-</span> <span class="fu">dcast</span>(test2<span class="sc">$</span>timeseries,Mon<span class="sc">~</span>Yr,<span class="at">value.var=</span><span class="st">"value"</span>,mean)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Mann-Kendall test for trend on each time series (column). </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>mk_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(test2.df[, <span class="sc">-</span><span class="dv">1</span>], MannKendall)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(mk_results, <span class="cf">function</span>(x) x<span class="sc">$</span>sl)  <span class="co"># p-values</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>tau_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(mk_results, <span class="cf">function</span>(x) x<span class="sc">$</span>tau)  <span class="co"># Tau values</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a chi-square test for heterogeneity</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>chi_square_result <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(p_values)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>chi_square_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared test for given probabilities

data:  p_values
X-squared = 0.23847, df = 4, p-value = 0.9934</code></pre>
</div>
</div>
<p>However, because how it performs trend test the values differ slightly. This is where knowing/learning how to lift the hood of the functions/packages helps. If you dig into the source code for the <code>Kendall</code> R-package you find that the functions within use a Fortran script with functions in it that differ slightly from how other packages do it. Not saying its wrong or right, just different.</p>
<p>The <code>wql</code> R-package has a tests for homogeneity of seasonal trends function and produces results identical to those produced by <code>EnvStats</code>.</p>
<!-- https://github.com/jsta/wql/blob/master/R/trendHomog.R -->
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wql)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ts</span>(test2<span class="sc">$</span>timeseries<span class="sc">$</span>value,<span class="at">frequency =</span> <span class="dv">12</span>)<span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trendHomog</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$chi2.trend
[1] 67.28

$chi2.homog
[1] 0.4

$p.value
[1] 0.9999996

$n
[1] 12</code></pre>
</div>
</div>
<p>If you are curious like me and wonder how the chi squared is EXACTLY calculated here is the simplified code extracted (and slightly modified) from the <code>wql::trendHomog</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>test2.df <span class="ot">&lt;-</span> <span class="fu">dcast</span>(test2<span class="sc">$</span>timeseries,Yr<span class="sc">~</span>Mon,<span class="at">value.var=</span><span class="st">"value"</span>,mean)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>vBH_hetero <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  Sval <span class="ot">&lt;-</span> <span class="fu">apply</span>(x,<span class="dv">2</span>,<span class="at">FUN =</span> <span class="cf">function</span>(y){</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> y</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(y)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    outr <span class="ot">&lt;-</span> <span class="fu">sign</span>(<span class="fu">outer</span>(y, y, <span class="st">"-"</span>)<span class="sc">/</span><span class="fu">outer</span>(t, t, <span class="st">"-"</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    S <span class="ot">&lt;-</span> <span class="fu">sum</span>(outr[<span class="fu">lower.tri</span>(outr)],<span class="at">na.rm=</span>T)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(S)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  varS <span class="ot">&lt;-</span> <span class="fu">apply</span>(x,<span class="dv">2</span>,<span class="at">FUN =</span> <span class="cf">function</span>(y){</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    ties <span class="ot">&lt;-</span> <span class="fu">rle</span>(<span class="fu">sort</span>(y))<span class="sc">$</span>lengths</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    t1 <span class="ot">&lt;-</span> n <span class="sc">*</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">*</span> n <span class="sc">+</span> <span class="dv">5</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    t2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(ties <span class="sc">*</span> (ties <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">*</span> ties <span class="sc">+</span> <span class="dv">5</span>))</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    varS <span class="ot">&lt;-</span> (t1 <span class="sc">-</span> t2)<span class="sc">/</span><span class="dv">18</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(varS)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  fr <span class="ot">&lt;-</span> <span class="fu">length</span>(varS)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">&lt;-</span> Sval <span class="sc">/</span> <span class="fu">sqrt</span>(varS)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  chi2.tot <span class="ot">&lt;-</span> <span class="fu">sum</span>(Z <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  Zbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(Z)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  chi2.trend <span class="ot">&lt;-</span> fr <span class="sc">*</span> Zbar <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  chi2.homog <span class="ot">&lt;-</span> chi2.tot <span class="sc">-</span> chi2.trend</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(chi2.homog, fr <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="cn">FALSE</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">chi2.trend =</span> chi2.trend,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">chi2.homog =</span> chi2.homog,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">p.value =</span> p.value,</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> fr)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Input data by removing the month column</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="fu">vBH_hetero</span>(test2.df[,<span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chi2.trend chi2.homog   p.value  n
1      67.28        0.4 0.9999996 12</code></pre>
</div>
</div>
</section>
<section id="other-kendall-tests" class="level2">
<h2 class="anchored" data-anchor-id="other-kendall-tests">Other Kendall Tests</h2>
<p>There are other Kendall tests but they are generally variants to the Mann-Kendall or seasonal Mann-Kendall including the Regional Kendall Tests which can also include seasonal tests. Other tests to include in the Kendall family are flow-adjusted trends and censored data (non-detects).</p>
</section>
<section id="usgs-software-vs-r-package" class="level2">
<h2 class="anchored" data-anchor-id="usgs-software-vs-r-package">USGS software vs R-package</h2>
<p>As mentioned at the start of this post, the USGS Kendall family of trend tests (<a href="https://pubs.usgs.gov/publication/sir20055275" target="_blank">link to info</a>). Typically this software (and the code behind it) is used by some analyst to benchmark again other routines/code/methods. Much like how some estimates of a given statistical test can vary between packages based on the way things are calculated or how the different code infrastructure does the maths. That being said there is no direct translation or “R-version” of the USGS program (yet…saving it for a rainy day). For those interested, here is a workflow comparison between the USGS software and the various R-package.</p>
<div class="cell">
<div class="cell-output-display">

<div class="tabwid"><style>.cl-9940701c{}.cl-9936d0a2{font-family:'Arial';font-size:10pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9936d0a3{font-family:'Arial';font-size:10pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-993a2d10{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-993a2d11{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-993a5416{width:2.128in;background-color:rgba(244, 244, 244, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a5417{width:2in;background-color:rgba(244, 244, 244, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a5418{width:2.874in;background-color:rgba(244, 244, 244, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a5419{width:2.128in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a541a{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a541b{width:2.874in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a541c{width:2.128in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a541d{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a541e{width:2.874in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a541f{width:2.128in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a5420{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a7b1c{width:2.874in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a7b1d{width:2.128in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a7b1e{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a7b1f{width:2.874in;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a7b20{width:2.128in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a7b21{width:2in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-993a7b22{width:2.874in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-9940701c"><thead><tr style="overflow-wrap:break-word;"><th class="cl-993a5416"><p class="cl-993a2d10"><span class="cl-9936d0a2">Feature</span></p></th><th class="cl-993a5417"><p class="cl-993a2d10"><span class="cl-9936d0a2">USGS Kendall Software</span></p></th><th class="cl-993a5418"><p class="cl-993a2d10"><span class="cl-9936d0a2">R Packages</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-993a5419"><p class="cl-993a2d11"><span class="cl-9936d0a3">Mann-Kendall Test</span></p></td><td class="cl-993a541a"><p class="cl-993a2d10"><span class="cl-9936d0a3">Built-in</span></p></td><td class="cl-993a541b"><p class="cl-993a2d10"><span class="cl-9936d0a3">`Kendall`, `trend`, `EnvStats`</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-993a541c"><p class="cl-993a2d11"><span class="cl-9936d0a3">Seasonal Kendall Test</span></p></td><td class="cl-993a541d"><p class="cl-993a2d10"><span class="cl-9936d0a3">Built-in</span></p></td><td class="cl-993a541e"><p class="cl-993a2d10"><span class="cl-9936d0a3">`trend::seaKen`, `wq`</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-993a541f"><p class="cl-993a2d11"><span class="cl-9936d0a3">Flow-Adjusted Trends</span></p></td><td class="cl-993a5420"><p class="cl-993a2d10"><span class="cl-9936d0a3">Built-in</span></p></td><td class="cl-993a7b1c"><p class="cl-993a2d10"><span class="cl-9936d0a3">Customizable (e.g., `mgcv`), `EGRET`</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-993a541f"><p class="cl-993a2d11"><span class="cl-9936d0a3">Censored Data Handling</span></p></td><td class="cl-993a5420"><p class="cl-993a2d10"><span class="cl-9936d0a3">Built-in</span></p></td><td class="cl-993a7b1c"><p class="cl-993a2d10"><span class="cl-9936d0a3">`NADA`, `NADA2`, `survival`</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-993a7b1d"><p class="cl-993a2d11"><span class="cl-9936d0a3">Theil-Sen Slope Estimation</span></p></td><td class="cl-993a7b1e"><p class="cl-993a2d10"><span class="cl-9936d0a3">Built-in</span></p></td><td class="cl-993a7b1f"><p class="cl-993a2d10"><span class="cl-9936d0a3">`trend`, `mblm`, `wq`</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-993a541f"><p class="cl-993a2d11"><span class="cl-9936d0a3">Autocorrelation Adjustment</span></p></td><td class="cl-993a5420"><p class="cl-993a2d10"><span class="cl-9936d0a3">Built-in (limited)</span></p></td><td class="cl-993a7b1c"><p class="cl-993a2d10"><span class="cl-9936d0a3">`trend`, `zyp`</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-993a7b20"><p class="cl-993a2d11"><span class="cl-9936d0a3">Visualization</span></p></td><td class="cl-993a7b21"><p class="cl-993a2d10"><span class="cl-9936d0a3">Basic</span></p></td><td class="cl-993a7b22"><p class="cl-993a2d10"><span class="cl-9936d0a3">`ggplot2`, Base R</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>Remember (as discussed above) some R-packages calculate things slightly different. They shouldn’t be so different that it would changes the final outcome but enough to question how a particular statistic was calculated.</p>
</section>
</section>
<section id="whats-next" class="level1">
<h1>Whats next?</h1>
<p>Hope this provided you with some additional understanding of how trend analyses work, some of the assumptions of the data needed and verify your results to be more confident in your trend analysis adventures. The next post will dig into stationary and periodicity in terms of trend analysis and what that means for other tests.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>- Session info ---------------------------------------------------------------
 setting  value
 version  R version 4.1.0 (2021-05-18)
 os       Windows 10 x64 (build 26100)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United States.1252
 ctype    English_United States.1252
 tz       America/New_York
 date     2026-01-06
 pandoc   2.19.2
 quarto   1.3.450

- Packages -------------------------------------------------------------------
 package       * version date (UTC) lib source
 AnalystHelper * 0.2.0   2025-11-17 []  local
 EnvStats      * 3.0.0   2024-08-24 []  CRAN (R 4.1.0)
 flextable     * 0.8.5   2023-01-29 []  CRAN (R 4.1.3)
 Kendall       * 2.2.1   2022-03-20 []  CRAN (R 4.1.3)
 reshape2      * 1.4.4   2020-04-09 []  CRAN (R 4.1.3)
 sessioninfo   * 1.2.2   2021-12-06 []  CRAN (R 4.1.3)
 wql           * 1.0.1   2024-05-28 []  CRAN (R 4.1.0)


------------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© CC-By Paul Julian II</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>